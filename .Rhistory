pivot_wider(names_from = unique_id, values_from = ly) %>%
arrange(ds) %>%
dplyr::select(-ds)
df_wide_ly
?select
df <- df %>%
mutate(ly = log(y))
plot_facets(df, "ly", "Log", "Series en log")
df_wide_ly <- df %>%
dplyr::filter(is.finite(ly)) %>%
dplyr::select(ds, unique_id, ly) %>%
tidyr::pivot_wider(names_from = unique_id, values_from = ly) %>%
dplyr::arrange(ds) %>%
tidyr::drop_na(igae, consumo, inversion) %>%
dplyr::select(-ds)
model <- lm(igae ~ consumo + inversion, data = df_wide_ly)
coeftest(model, vcov = NeweyWest(model, lag = 12, prewhite = FALSE))
summary(model)
coeftest(model, vcov = NeweyWest(model, lag = 12, prewhite = FALSE))
model <- lm(igae ~ consumo + inversion, data = df_wide_ly, vcov='HAC')
summary(model)
summary(model)
df_wide_ly <- df %>%
filter(is.finite(ly)) %>%
dplyr::select(ds, unique_id, ly) %>%
pivot_wider(names_from = unique_id, values_from = ly) %>%
arrange(ds) %>%
drop_na(igae, consumo, inversion) %>%
dplyr::select(-ds)
coeftest(model, vcov. = NeweyWest(model))
summary(model)
?summary
library(estimatr)
install.packages('estimatr')
library(estimatr)
# Esto hace todo en un solo paso
model_robust <- lm_robust(igae ~ consumo + inversion,
data = df_wide_ly,
se_type = "stata") # O "HC1", "Newey-West" (con argumentos extra)
summary(model_robust)
# Esto hace todo en un solo paso
model_robust <- lm_robust(igae ~ consumo + inversion,
data = df_wide_ly,
se_type = "Newer-West") # O "HC1", "Newey-West" (con argumentos extra)
# Esto hace todo en un solo paso
model_robust <- lm_robust(igae ~ consumo + inversion,
data = df_wide_ly,
se_type = "Newey-West") # O "HC1", "Newey-West" (con argumentos extra)
coeftest(model, vcov. = NeweyWest(model))
summary(model)
?lm
modelsummary(model,
vcov = NeweyWest,
stars = TRUE,
fmt = 4)
library(modelsummary)
install.packages('modelsummary')
library(modelsummary)
modelsummary(model,
vcov = NeweyWest,
stars = TRUE,
fmt = 4)
modelsummary(model,
vcov = NeweyWest,
stars = TRUE)
waldtest(model, vcov = NeweyWest)
library(fixest)
install.packages('fixest')
library(fixest)
model_fixest <- feols(igae ~ consumo + inversion,
data = df_wide_ly,
vcov = "NW")
df_wide_ly
df_wide_ly <- df %>%
filter(is.finite(ly)) %>%
dplyr::select(ds, unique_id, ly) %>%
pivot_wider(names_from = unique_id, values_from = ly) %>%
arrange(ds) %>%
drop_na(igae, consumo, inversion)
df_wide_ly <- df %>%
filter(is.finite(ly)) %>%
dplyr::select(ds, unique_id, ly) %>%
pivot_wider(names_from = unique_id, values_from = ly) %>%
arrange(ds) %>%
drop_na(igae, consumo, inversion)
model <- lm(igae ~ consumo + inversion, data = df_wide_ly, vcov='HAC')
coeftest(model, vcov. = NeweyWest(model))
library(fixest)
model_fixest <- feols(igae ~ consumo + inversion,
data = df_wide_ly,
vcov = "NW",
# Aquí le dices cuál es la variable de tiempo:
panel.id = ~fecha)
model_fixest <- feols(igae ~ consumo + inversion,
data = df_wide_ly,
vcov = "NW",
# Aquí le dices cuál es la variable de tiempo:
panel.id = ~ds)
df_wide_ly
model_fixest <- feols(igae ~ consumo + inversion,
data = df_wide_ly,
vcov = "NW",
panel.id = ~ds)
model_fixest <- feols(igae ~ consumo + inversion,
data = df_wide_ly,
vcov = "HAC",
panel.id = ~ds)
model_fixest <- feols(igae ~ consumo + inversion,
data = df_wide_ly,
vcov = "NW",
panel.id = ~ds)
model_fixest <- feols(igae ~ consumo + inversion,
data = df_wide_ly,
vcov = "NW",
panel.id = ~id + ds)
model_fixest <- feols(igae ~ consumo + inversion,
data = df_wide_ly,
vcov = "NW",
panel.id = ~consumo + inversion + ds)
etable(model_fixest)
model_fixest <- feols(igae ~ consumo + inversion,
data = df_wide_ly,
vcov = "NW",
panel.id = igae~consumo + inversion + ds)
etable(model_fixest)
summary(model_fixest)
coeftest(model, vcov. = NeweyWest(model))
sandwich::vcovHAC(model)
coeftest(model, vcov. = NeweyWest(model))
model <- lm(igae ~ consumo + inversion, data = df_wide_ly, vcov='HAC')
summary(model)
model <- lm(igae ~ consumo + inversion, data = df_wide_ly, vcov='HC3')
coeftest(model, vcov. = NeweyWest(model))
summary(model)
model <- lm(igae ~ consumo + inversion, data = df_wide_ly, vcov='HfafdsaC3')
model <- lm(igae ~ consumo + inversion, data = df_wide_ly)
coeftest(model, vcov. = NeweyWest(model))
summary(model)
coeftest(model, vcov. = NeweyWest(model))
summary(model)
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_chunk$set(echo = TRUE)
## Setup
```{r}
library(tidyverse)
library(tseries)
library(urca)
library(vars)
library(lmtest)
library(sandwich)
library(tidyverse)
library(tseries)
library(urca)
library(vars)
library(lmtest)
library(sandwich)
## Data load (long format)
```{r}
df <- read_csv("data/series.csv") %>%
arrange(unique_id, ds)
df <- read_csv("data/series.csv") %>%
arrange(unique_id, ds)
## Exploratory plots
```{r}
plot_facets <- function(df_long, value_col, ylabel, title) {
ggplot(df_long, aes(x = ds, y = .data[[value_col]])) +
geom_line() +
facet_wrap(~unique_id) +
labs(title = title, x = NULL, y = ylabel) +
theme_minimal(base_size = 11)
}
plot_facets <- function(df_long, value_col, ylabel, title) {
ggplot(df_long, aes(x = ds, y = .data[[value_col]])) +
geom_line() +
facet_wrap(~unique_id) +
labs(title = title, x = NULL, y = ylabel) +
theme_minimal(base_size = 11)
}
```{r}
plot_facets(df, "y", "Indice", "Indice base 2018")
plot_facets(df, "y", "Indice", "Indice base 2018")
```{r}
df <- df %>%
group_by(unique_id) %>%
mutate(yoy = (y / lag(y, 12) - 1) * 100) %>%
ungroup()
df <- df %>%
group_by(unique_id) %>%
mutate(yoy = (y / lag(y, 12) - 1) * 100) %>%
ungroup()
## Stationarity tests
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(tseries)
library(urca)
library(vars)
library(lmtest)
library(sandwich)
df <- read_csv("data/series.csv") %>%
arrange(unique_id, ds)
plot_facets <- function(df_long, value_col, ylabel, title) {
ggplot(df_long, aes(x = ds, y = .data[[value_col]])) +
geom_line() +
facet_wrap(~unique_id) +
labs(title = title, x = NULL, y = ylabel) +
theme_minimal(base_size = 11)
}
plot_facets(df, "y", "Indice", "Indice base 2018")
df <- df %>%
group_by(unique_id) %>%
mutate(yoy = (y / lag(y, 12) - 1) * 100) %>%
ungroup()
plot_facets(df, "yoy", "Cambio porcentual anual (%)", "Variacion anual (%)")
adf_test <- function(series) {
test <- adf.test(na.omit(series))
tibble(
adf_stat = unname(test$statistic),
p_value = test$p.value,
n_lags = unname(test$parameter)
)
}
kpss_test <- function(series, null = "Trend") {
test <- kpss.test(na.omit(series), null = null)
tibble(
kpss_stat = unname(test$statistic),
kpss_p = test$p.value,
kpss_lags = unname(test$parameter)
)
}
adf_df <- df %>%
group_by(unique_id) %>%
group_modify(~adf_test(.x$y)) %>%
ungroup()
kpss_df <- df %>%
group_by(unique_id) %>%
group_modify(~kpss_test(.x$y, null = "Trend")) %>%
ungroup()
adf_df
kpss_df
df <- df %>%
group_by(unique_id) %>%
mutate(dy = y - lag(y)) %>%
ungroup()
plot_facets(df, "dy", "Delta y", "Delta y, indices diferenciados")
adf_dy <- df %>%
group_by(unique_id) %>%
group_modify(~adf_test(.x$dy)) %>%
ungroup()
kpss_dy <- df %>%
group_by(unique_id) %>%
group_modify(~kpss_test(.x$dy, null = "Level")) %>%
ungroup()
adf_dy
kpss_dy
df_wide <- df %>%
dplyr::select(ds, unique_id, y) %>%
tidyr::pivot_wider(names_from = unique_id, values_from = y) %>%
dplyr::arrange(ds) %>%
tidyr::drop_na(igae, consumo, inversion)
start_year <- lubridate::year(min(df_wide$ds))
start_month <- lubridate::month(min(df_wide$ds))
Y_ts <- ts(
df_wide %>% dplyr::select(igae, consumo, inversion),
start = c(start_year, start_month),
frequency = 12
)
lag_sel <- VARselect(Y_ts, lag.max = 12, type = "const")
lag_sel$selection
K <- as.integer(lag_sel$selection["AIC(n)"])
joh_trace <- ca.jo(Y_ts, type = "trace", ecdet = "const", K = K)
summary(joh_trace)
joh_eigen <- ca.jo(Y_ts, type = "eigen", ecdet = "const", K = K)
summary(joh_eigen)
df <- df %>%
mutate(ly = log(y))
plot_facets(df, "ly", "Log", "Series en log")
df_wide_ly <- df %>%
dplyr::filter(is.finite(ly)) %>%
dplyr::select(ds, unique_id, ly) %>%
tidyr::pivot_wider(names_from = unique_id, values_from = ly) %>%
dplyr::arrange(ds) %>%
tidyr::drop_na(igae, consumo, inversion)
model <- lm(igae ~ consumo + inversion, data = df_wide_ly)
coeftest(model, vcov = NeweyWest(model, lag = 12, prewhite = FALSE))
summary(model)
adf_df
adf_df
```{r}
kpss_df
df <- df %>%
group_by(unique_id) %>%
mutate(dy = y - lag(y)) %>%
ungroup()
df <- df %>%
group_by(unique_id) %>%
mutate(dy = y - lag(y)) %>%
ungroup()
df <- df %>%
group_by(unique_id) %>%
mutate(dy = y - lag(y)) %>%
ungroup()
```{r}
plot_facets(df, "dy", "Delta y", "Delta y, indices diferenciados")
plot_facets(df, "dy", "Delta y", "Delta y, indices diferenciados")
```{r}
adf_dy <- df %>%
group_by(unique_id) %>%
group_modify(~adf_test(.x$dy)) %>%
ungroup()
kpss_dy <- df %>%
group_by(unique_id) %>%
group_modify(~kpss_test(.x$dy, null = "Level")) %>%
ungroup()
adf_dy
adf_dy
```{r}
kpss_dy
kpss_dy
## VAR and cointegration
```{r}
df_wide <- df %>%
dplyr::select(ds, unique_id, y) %>%
tidyr::pivot_wider(names_from = unique_id, values_from = y) %>%
dplyr::arrange(ds) %>%
tidyr::drop_na(igae, consumo, inversion)
start_year <- lubridate::year(min(df_wide$ds))
start_month <- lubridate::month(min(df_wide$ds))
Y_ts <- ts(
df_wide %>% dplyr::select(igae, consumo, inversion),
start = c(start_year, start_month),
frequency = 12
)
lag_sel <- VARselect(Y_ts, lag.max = 12, type = "const")
lag_sel$selection
K <- as.integer(lag_sel$selection["AIC(n)"])
joh_trace <- ca.jo(Y_ts, type = "trace", ecdet = "const", K = K)
summary(joh_trace)
joh_eigen <- ca.jo(Y_ts, type = "eigen", ecdet = "const", K = K)
summary(joh_eigen)
joh_eigen <- ca.jo(Y_ts, type = "eigen", ecdet = "const", K = K)
summary(joh_eigen)
## Log transform and regression
```{r}
df <- df %>%
mutate(ly = log(y))
df <- df %>%
mutate(ly = log(y))
```{r}
plot_facets(df, "ly", "Log", "Series en log")
plot_facets(df, "ly", "Log", "Series en log")
```{r}
df_wide_ly <- df %>%
dplyr::filter(is.finite(ly)) %>%
dplyr::select(ds, unique_id, ly) %>%
tidyr::pivot_wider(names_from = unique_id, values_from = ly) %>%
dplyr::arrange(ds) %>%
tidyr::drop_na(igae, consumo, inversion)
model <- lm(igae ~ consumo + inversion, data = df_wide_ly)
coeftest(model, vcov = NeweyWest(model, lag = 12, prewhite = FALSE))
summary(model)
knitr::opts_chunk$set(echo = TRUE, warning = FALSE)
library(tidyverse)
library(tseries)
library(urca)
library(vars)
library(lmtest)
library(sandwich)
library(kableExtra)
install.packages('kableExtra')
library(tidyverse)
library(tseries)
library(urca)
library(vars)
library(lmtest)
library(sandwich)
library(kableExtra)
knitr::opts_chunk$set(echo = TRUE, warning = FALSE)
library(tidyverse)
library(tseries)
library(urca)
library(vars)
library(lmtest)
library(sandwich)
library(kableExtra)
df <- read_csv("data/series.csv") %>%
arrange(unique_id, ds)
plot_facets <- function(df_long, value_col, ylabel, title) {
ggplot(df_long, aes(x = ds, y = .data[[value_col]])) +
geom_line() +
facet_wrap(~unique_id) +
labs(title = title, x = NULL, y = ylabel) +
theme_minimal(base_size = 11)
}
plot_facets(df, "y", "Indice", "Indice base 2018")
df <- df %>%
group_by(unique_id) %>%
mutate(yoy = (y / lag(y, 12) - 1) * 100) %>%
ungroup()
plot_facets(df, "yoy", "Cambio porcentual anual (%)", "Variacion anual (%)")
adf_test <- function(series) {
test <- adf.test(na.omit(series))
tibble(
adf_stat = unname(test$statistic),
p_value = test$p.value,
n_lags = unname(test$parameter)
)
}
kpss_test <- function(series, null = "Trend") {
test <- kpss.test(na.omit(series), null = null)
tibble(
kpss_stat = unname(test$statistic),
kpss_p = test$p.value,
kpss_lags = unname(test$parameter)
)
}
adf_df <- df %>%
group_by(unique_id) %>%
group_modify(~adf_test(.x$y)) %>%
ungroup()
kpss_df <- df %>%
group_by(unique_id) %>%
group_modify(~kpss_test(.x$y, null = "Trend")) %>%
ungroup()
adf_df %>% kable() %>% kable_styling(full_width = FALSE)
kpss_df %>% kable() %>% kable_styling(full_width = FALSE)
?kable
adf_df %>% kable(col.names = c('Variables', 'ADF Stat', 'p-val', 'n_lags')) %>% kable_styling(full_width = FALSE)
adf_df %>% kable() %>% kable_styling(full_width = FALSE)
kpss_df %>% kable() %>% kable_styling(full_width = FALSE)
adf_df %>% kable()
kpss_df %>% kable()
df <- df %>%
group_by(unique_id) %>%
mutate(dy = y - lag(y)) %>%
ungroup()
plot_facets(df, "dy", "Delta y", "Delta y, indices diferenciados")
adf_dy <- df %>%
group_by(unique_id) %>%
group_modify(~adf_test(.x$dy)) %>%
ungroup()
kpss_dy <- df %>%
group_by(unique_id) %>%
group_modify(~kpss_test(.x$dy, null = "Level")) %>%
ungroup()
adf_dy %>% kable()
kpss_dy %>% kable()
df_wide <- df %>%
dplyr::select(ds, unique_id, y) %>%
tidyr::pivot_wider(names_from = unique_id, values_from = y) %>%
dplyr::arrange(ds) %>%
tidyr::drop_na(igae, consumo, inversion)
start_year <- lubridate::year(min(df_wide$ds))
start_month <- lubridate::month(min(df_wide$ds))
Y_ts <- ts(
df_wide %>% dplyr::select(igae, consumo, inversion),
start = c(start_year, start_month),
frequency = 12
)
lag_sel <- VARselect(Y_ts, lag.max = 12, type = "const")
lag_sel$selection
as.data.frame(t(lag_sel$selection)) %>%
kable() %>%
kable_styling(full_width = FALSE)
K <- as.integer(lag_sel$selection["AIC(n)"])
joh_trace <- ca.jo(Y_ts, type = "trace", ecdet = "const", K = K)
summary(joh_trace)
joh_eigen <- ca.jo(Y_ts, type = "eigen", ecdet = "const", K = K)
summary(joh_eigen)
df <- df %>%
mutate(ly = log(y))
plot_facets(df, "ly", "Log", "Series en log")
df_wide_ly <- df %>%
dplyr::filter(is.finite(ly)) %>%
dplyr::select(ds, unique_id, ly) %>%
tidyr::pivot_wider(names_from = unique_id, values_from = ly) %>%
dplyr::arrange(ds) %>%
tidyr::drop_na(igae, consumo, inversion)
model <- lm(igae ~ consumo + inversion, data = df_wide_ly)
coeftest(model, vcov = NeweyWest(model, lag = 12, prewhite = FALSE)) %>%
as.data.frame() %>%
kable() %>%
kable_styling(full_width = FALSE)
df_wide_ly <- df %>%
dplyr::filter(is.finite(ly)) %>%
dplyr::select(ds, unique_id, ly) %>%
tidyr::pivot_wider(names_from = unique_id, values_from = ly) %>%
dplyr::arrange(ds) %>%
tidyr::drop_na(igae, consumo, inversion)
model <- lm(igae ~ consumo + inversion, data = df_wide_ly)
coeftest(model, vcov = NeweyWest(model, lag = 12, prewhite = FALSE)) %>%
as.data.frame() %>%
kable() %>%
kable_styling(full_width = FALSE)
coeftest(model, vcov = NeweyWest()
coeftest(model, vcov = NeweyWest())
_coeftest
?coeftest
coeftest(model, vcov. = vcovHAC())
coeftest(model, vcov. = vcovHAC
coeftest(model, vcov. = vcovHAC)
coeftest(model, vcov. = vcovHC)
coeftest(model, vcov. = NeweyWest())
coeftest(model, vcov. = NeweyWest(model))
coeftest(model, vcov. = vcovHAC(model))
summary(model)
?vcovHAC()
coeftest(model, vcov. = vcovHAC(model))
coeftest(model, vcov = vcovHAC(model))
coeftest(model, vcov = vcovHAC(model, n=Inf))
coeftest(model, vcov = vcovHAC(model))
summary(model)
coeftest(model, vcov = vcovHAC(model))
